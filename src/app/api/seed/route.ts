import { NextResponse } from "next/server";
import { initializeDataSource } from "../../../data-source";
import { Deal } from "../../../lib/entities/deals/Deal";
import { cityToTerritory } from "@/lib/geo/geo-utils";

const sampleDeals = [
  {
    deal_id: "RV-001",
    company_name: "Pacific Logistics Inc",
    contact_name: "Sarah Chen",
    transportation_mode: "ocean",
    stage: "proposal",
    value: 45000,
    probability: 70,
    created_date: "2024-10-15T09:00:00Z",
    updated_date: "2024-11-28T14:30:00Z",
    expected_close_date: "2024-12-15T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "Los Angeles, CA",
    destination_city: "Shanghai, China",
    cargo_type: "Electronics",
  },
  {
    deal_id: "RV-002",
    company_name: "Mountain Transport Co",
    contact_name: "David Park",
    transportation_mode: "trucking",
    stage: "negotiation",
    value: 12000,
    probability: 85,
    created_date: "2024-11-01T11:15:00Z",
    updated_date: "2024-12-03T16:45:00Z",
    expected_close_date: "2024-12-10T00:00:00Z",
    sales_rep: "Jennifer Walsh",
    origin_city: "Denver, CO",
    destination_city: "Phoenix, AZ",
    cargo_type: "Machinery",
  },
  {
    deal_id: "RV-003",
    company_name: "Global Freight Solutions",
    contact_name: "Maria Rodriguez",
    transportation_mode: "air",
    stage: "prospect",
    value: 75000,
    probability: 30,
    created_date: "2024-11-20T08:30:00Z",
    updated_date: "2024-11-25T10:15:00Z",
    expected_close_date: "2025-01-20T00:00:00Z",
    sales_rep: "Tom Wilson",
    origin_city: "Miami, FL",
    destination_city: "London, UK",
    cargo_type: "Pharmaceuticals",
  },
  {
    deal_id: "RV-004",
    company_name: "Midwest Rail Corp",
    contact_name: "James Thompson",
    transportation_mode: "rail",
    stage: "qualified",
    value: 28000,
    probability: 60,
    created_date: "2024-11-10T14:20:00Z",
    updated_date: "2024-11-30T09:45:00Z",
    expected_close_date: "2024-12-25T00:00:00Z",
    sales_rep: "Lisa Anderson",
    origin_city: "Chicago, IL",
    destination_city: "Houston, TX",
    cargo_type: "Automotive Parts",
  },
  {
    deal_id: "RV-005",
    company_name: "Coastal Shipping LLC",
    contact_name: "Robert Kim",
    transportation_mode: "ocean",
    stage: "closed_won",
    value: 95000,
    probability: 100,
    created_date: "2024-10-05T12:00:00Z",
    updated_date: "2024-11-15T16:30:00Z",
    expected_close_date: "2024-11-30T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "Seattle, WA",
    destination_city: "Tokyo, Japan",
    cargo_type: "Consumer Goods",
  },
  {
    deal_id: "RV-006",
    company_name: "Express Trucking Inc",
    contact_name: "Amanda Foster",
    transportation_mode: "trucking",
    stage: "closed_lost",
    value: 18000,
    probability: 0,
    created_date: "2024-09-15T10:30:00Z",
    updated_date: "2024-11-20T14:00:00Z",
    expected_close_date: "2024-11-01T00:00:00Z",
    sales_rep: "Jennifer Walsh",
    origin_city: "Atlanta, GA",
    destination_city: "New York, NY",
    cargo_type: "Food Products",
  },
  {
    deal_id: "RV-007",
    company_name: "International Air Cargo",
    contact_name: "Carlos Mendez",
    transportation_mode: "air",
    stage: "proposal",
    value: 52000,
    probability: 65,
    created_date: "2024-11-05T09:15:00Z",
    updated_date: "2024-12-01T11:20:00Z",
    expected_close_date: "2024-12-20T00:00:00Z",
    sales_rep: "Tom Wilson",
    origin_city: "Dallas, TX",
    destination_city: "Frankfurt, Germany",
    cargo_type: "Technology Equipment",
  },
  {
    deal_id: "RV-008",
    company_name: "Northern Rail Services",
    contact_name: "Emily Johnson",
    transportation_mode: "rail",
    stage: "prospect",
    value: 33000,
    probability: 25,
    created_date: "2024-11-25T13:45:00Z",
    updated_date: "2024-12-02T15:30:00Z",
    expected_close_date: "2025-01-15T00:00:00Z",
    sales_rep: "Lisa Anderson",
    origin_city: "Minneapolis, MN",
    destination_city: "Portland, OR",
    cargo_type: "Raw Materials",
  },
  {
    deal_id: "RV-009",
    company_name: "Atlantic Shipping Co",
    contact_name: "Michael Brown",
    transportation_mode: "ocean",
    stage: "qualified",
    value: 67000,
    probability: 55,
    created_date: "2024-10-20T11:00:00Z",
    updated_date: "2024-11-28T13:15:00Z",
    expected_close_date: "2024-12-30T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "Boston, MA",
    destination_city: "Rotterdam, Netherlands",
    cargo_type: "Industrial Equipment",
  },
  {
    deal_id: "RV-010",
    company_name: "Southwest Logistics",
    contact_name: "Jessica Martinez",
    transportation_mode: "trucking",
    stage: "negotiation",
    value: 22000,
    probability: 80,
    created_date: "2024-11-12T16:20:00Z",
    updated_date: "2024-12-04T10:45:00Z",
    expected_close_date: "2024-12-18T00:00:00Z",
    sales_rep: "Jennifer Walsh",
    origin_city: "Phoenix, AZ",
    destination_city: "Las Vegas, NV",
    cargo_type: "Construction Materials",
  },
  {
    deal_id: "RV-011",
    company_name: "NorthStar Freight",
    contact_name: "Ava Patel",
    transportation_mode: "rail",
    stage: "closed_won",
    value: 48000,
    probability: 100,
    created_date: "2024-04-12T09:45:00Z",
    updated_date: "2024-05-02T10:10:00Z",
    expected_close_date: "2024-05-05T00:00:00Z",
    sales_rep: "Lisa Anderson",
    origin_city: "Seattle, WA",
    destination_city: "Vancouver, Canada",
    cargo_type: "Lumber",
  },
  {
    deal_id: "RV-012",
    company_name: "Lone Star Trucking",
    contact_name: "Ethan Ramirez",
    transportation_mode: "trucking",
    stage: "prospect",
    value: 26000,
    probability: 40,
    created_date: "2024-05-18T12:20:00Z",
    updated_date: "2024-05-25T15:00:00Z",
    expected_close_date: "2024-07-01T00:00:00Z",
    sales_rep: "Jennifer Walsh",
    origin_city: "Austin, TX",
    destination_city: "Houston, TX",
    cargo_type: "Steel",
  },
  {
    deal_id: "RV-013",
    company_name: "Great Lakes Shipping",
    contact_name: "Benjamin Lee",
    transportation_mode: "ocean",
    stage: "qualified",
    value: 71000,
    probability: 55,
    created_date: "2024-06-04T08:15:00Z",
    updated_date: "2024-06-29T11:00:00Z",
    expected_close_date: "2024-08-10T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "Chicago, IL",
    destination_city: "Hamburg, Germany",
    cargo_type: "Industrial Machinery",
  },
  {
    deal_id: "RV-014",
    company_name: "Atlantic Air Express",
    contact_name: "Dylan Brooks",
    transportation_mode: "air",
    stage: "negotiation",
    value: 42000,
    probability: 75,
    created_date: "2024-06-20T14:30:00Z",
    updated_date: "2024-07-03T09:10:00Z",
    expected_close_date: "2024-07-20T00:00:00Z",
    sales_rep: "Tom Wilson",
    origin_city: "New York, NY",
    destination_city: "Paris, France",
    cargo_type: "Luxury Goods",
  },
  {
    deal_id: "RV-015",
    company_name: "Desert Railways",
    contact_name: "Grace Nguyen",
    transportation_mode: "rail",
    stage: "closed_lost",
    value: 30000,
    probability: 0,
    created_date: "2024-07-09T10:05:00Z",
    updated_date: "2024-08-01T13:30:00Z",
    expected_close_date: "2024-08-01T00:00:00Z",
    sales_rep: "Lisa Anderson",
    origin_city: "Phoenix, AZ",
    destination_city: "Las Vegas, NV",
    cargo_type: "Construction Steel",
  },
  {
    deal_id: "RV-016",
    company_name: "Bay Area Logistics",
    contact_name: "Samuel Carter",
    transportation_mode: "ocean",
    stage: "prospect",
    value: 82000,
    probability: 35,
    created_date: "2024-07-28T09:00:00Z",
    updated_date: "2024-08-15T12:00:00Z",
    expected_close_date: "2024-09-12T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "San Francisco, CA",
    destination_city: "Busan, Korea",
    cargo_type: "Tech Hardware",
  },
  {
    deal_id: "RV-017",
    company_name: "Heartland Carriers",
    contact_name: "Olivia Mitchell",
    transportation_mode: "trucking",
    stage: "qualified",
    value: 19000,
    probability: 60,
    created_date: "2024-08-11T11:25:00Z",
    updated_date: "2024-08-29T14:10:00Z",
    expected_close_date: "2024-09-18T00:00:00Z",
    sales_rep: "Jennifer Walsh",
    origin_city: "Minneapolis, MN",
    destination_city: "Chicago, IL",
    cargo_type: "Agriculture",
  },
  {
    deal_id: "RV-018",
    company_name: "Seaboard Cargo Lines",
    contact_name: "Noah Robinson",
    transportation_mode: "ocean",
    stage: "negotiation",
    value: 88000,
    probability: 70,
    created_date: "2024-08-27T15:30:00Z",
    updated_date: "2024-09-10T10:20:00Z",
    expected_close_date: "2024-10-05T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "Boston, MA",
    destination_city: "Dublin, Ireland",
    cargo_type: "Medical Devices",
  },
  {
    deal_id: "RV-019",
    company_name: "Rocky Mountain Freight",
    contact_name: "Isabella Scott",
    transportation_mode: "rail",
    stage: "closed_won",
    value: 54000,
    probability: 100,
    created_date: "2024-09-09T09:40:00Z",
    updated_date: "2024-10-01T08:25:00Z",
    expected_close_date: "2024-10-01T00:00:00Z",
    sales_rep: "Lisa Anderson",
    origin_city: "Denver, CO",
    destination_city: "Salt Lake City, UT",
    cargo_type: "Renewable Energy Parts",
  },
  {
    deal_id: "RV-020",
    company_name: "SunBelt Express",
    contact_name: "Mason Rivera",
    transportation_mode: "trucking",
    stage: "proposal",
    value: 31000,
    probability: 50,
    created_date: "2024-09-22T13:10:00Z",
    updated_date: "2024-10-05T14:45:00Z",
    expected_close_date: "2024-10-30T00:00:00Z",
    sales_rep: "Jennifer Walsh",
    origin_city: "Dallas, TX",
    destination_city: "Atlanta, GA",
    cargo_type: "Retail",
  },
  /* -------- Oct, Nov, Dec 2024 -------------------------------------- */
  {
    deal_id: "RV-021",
    company_name: "Blue Ridge Cargo",
    contact_name: "Liam Morgan",
    transportation_mode: "air",
    stage: "prospect",
    value: 47000,
    probability: 30,
    created_date: "2024-10-18T07:50:00Z",
    updated_date: "2024-11-02T09:45:00Z",
    expected_close_date: "2024-12-12T00:00:00Z",
    sales_rep: "Tom Wilson",
    origin_city: "Charlotte, NC",
    destination_city: "Rome, Italy",
    cargo_type: "Fashion Apparel",
  },
  {
    deal_id: "RV-022",
    company_name: "Great Plains Transit",
    contact_name: "Chloe Hall",
    transportation_mode: "rail",
    stage: "negotiation",
    value: 39000,
    probability: 65,
    created_date: "2024-10-29T10:05:00Z",
    updated_date: "2024-11-18T11:15:00Z",
    expected_close_date: "2024-11-25T00:00:00Z",
    sales_rep: "Lisa Anderson",
    origin_city: "Kansas City, KS",
    destination_city: "Chicago, IL",
    cargo_type: "Food Ingredients",
  },
  {
    deal_id: "RV-023",
    company_name: "Timberline Shipping",
    contact_name: "Amelia Torres",
    transportation_mode: "ocean",
    stage: "closed_lost",
    value: 60000,
    probability: 0,
    created_date: "2024-11-14T12:10:00Z",
    updated_date: "2024-12-05T09:00:00Z",
    expected_close_date: "2024-12-05T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "Seattle, WA",
    destination_city: "Osaka, Japan",
    cargo_type: "Furniture",
  },
  {
    deal_id: "RV-024",
    company_name: "Liberty Air Freight",
    contact_name: "Evelyn Hughes",
    transportation_mode: "air",
    stage: "qualified",
    value: 62000,
    probability: 55,
    created_date: "2024-12-03T08:25:00Z",
    updated_date: "2024-12-19T10:00:00Z",
    expected_close_date: "2025-01-10T00:00:00Z",
    sales_rep: "Tom Wilson",
    origin_city: "Philadelphia, PA",
    destination_city: "Berlin, Germany",
    cargo_type: "Pharma",
  },
  {
    deal_id: "RV-025",
    company_name: "Evergreen Logistics",
    contact_name: "Lucas Turner",
    transportation_mode: "trucking",
    stage: "prospect",
    value: 28000,
    probability: 35,
    created_date: "2025-01-07T09:30:00Z",
    updated_date: "2025-01-20T12:15:00Z",
    expected_close_date: "2025-02-15T00:00:00Z",
    sales_rep: "Jennifer Walsh",
    origin_city: "San Jose, CA",
    destination_city: "Los Angeles, CA",
    cargo_type: "Consumer Electronics",
  },
  {
    deal_id: "RV-026",
    company_name: "Prairie Rail Logistics",
    contact_name: "Harper Bennett",
    transportation_mode: "rail",
    stage: "proposal",
    value: 35000,
    probability: 60,
    created_date: "2025-01-18T11:10:00Z",
    updated_date: "2025-01-28T14:05:00Z",
    expected_close_date: "2025-02-20T00:00:00Z",
    sales_rep: "Lisa Anderson",
    origin_city: "Chicago, IL",
    destination_city: "St. Louis, MO",
    cargo_type: "Paper Goods",
  },
  {
    deal_id: "RV-027",
    company_name: "Gulf Coast Maritime",
    contact_name: "Henry Edwards",
    transportation_mode: "ocean",
    stage: "negotiation",
    value: 81000,
    probability: 75,
    created_date: "2025-01-30T06:45:00Z",
    updated_date: "2025-02-12T09:50:00Z",
    expected_close_date: "2025-03-05T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "Houston, TX",
    destination_city: "Port of Rotterdam, Netherlands",
    cargo_type: "Energy Equipment",
  },
  {
    deal_id: "RV-028",
    company_name: "Capital City Freight",
    contact_name: "Scarlett Price",
    transportation_mode: "air",
    stage: "closed_won",
    value: 56000,
    probability: 100,
    created_date: "2025-02-05T13:00:00Z",
    updated_date: "2025-02-19T11:30:00Z",
    expected_close_date: "2025-02-19T00:00:00Z",
    sales_rep: "Tom Wilson",
    origin_city: "Washington, DC",
    destination_city: "Geneva, Switzerland",
    cargo_type: "Government Docs",
  },
  {
    deal_id: "RV-029",
    company_name: "Ozark Transit",
    contact_name: "Jack Collins",
    transportation_mode: "trucking",
    stage: "qualified",
    value: 24000,
    probability: 50,
    created_date: "2025-02-12T10:05:00Z",
    updated_date: "2025-02-28T15:20:00Z",
    expected_close_date: "2025-03-18T00:00:00Z",
    sales_rep: "Jennifer Walsh",
    origin_city: "Kansas City, KS",
    destination_city: "Denver, CO",
    cargo_type: "Beverages",
  },
  {
    deal_id: "RV-030",
    company_name: "Metropolitan Logistics",
    contact_name: "Victoria Adams",
    transportation_mode: "ocean",
    stage: "closed_lost",
    value: 72000,
    probability: 0,
    created_date: "2025-02-20T09:40:00Z",
    updated_date: "2025-03-05T10:30:00Z",
    expected_close_date: "2025-03-05T00:00:00Z",
    sales_rep: "Mike Rodriguez",
    origin_city: "New York, NY",
    destination_city: "Singapore",
    cargo_type: "Automotive OEM",
  }
];

export async function POST() {
  try {
    const dataSource = await initializeDataSource();
    const dealRepository = dataSource.getRepository(Deal);

    await dealRepository.clear();
    console.log("Cleared existing deals");

    for (const dealData of sampleDeals) {
      const deal = dealRepository.create(dealData);
      deal.territory = cityToTerritory(deal.origin_city)
      await dealRepository.save(deal);
    }

    return NextResponse.json({
      message: `Successfully seeded ${sampleDeals.length} deals`,
      count: sampleDeals.length,
    });
  } catch (error) {
    console.error("Error seeding database:", error);
    return NextResponse.json(
      { error: "Failed to seed database" },
      { status: 500 }
    );
  }
}
